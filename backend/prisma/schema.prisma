generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TipoPrioridade {
  id               Int         @id @default(autoincrement())
  descricao        String      @db.VarChar(255)
  nivel_prioridade Int         @db.SmallInt
  ativo            Boolean     @default(true)
  criado_em        DateTime    @default(now()) @db.Timestamp(6)
  
  visitantes       Visitante[]

  @@map("tipo_prioridade")
}

model Visitante {
  id                   Int              @id @default(autoincrement())
  nome                 String           @db.VarChar(255)
  cpf                  String           @unique @db.VarChar(11)
  rg                   String?          @db.VarChar(20)
  data_nascimento      DateTime         @db.Date
  tipo_prioridade_id   Int
  foto                 String?          @db.Text
  ativo                Boolean          @default(true)
  criado_em            DateTime         @default(now()) @db.Timestamp(6)
  
  tipo_prioridade      TipoPrioridade   @relation(fields: [tipo_prioridade_id], references: [id])
  agendamentos         Agendamento[]
  acessos              Acesso[]

  @@map("visitante")
}

model Sala {
  id                  Int                @id @default(autoincrement())
  nome                String             @db.VarChar(255)
  disponibilidade     Json
  capacidade          Int
  variacao_capacidade Int                @default(2) @db.SmallInt
  ativo               Boolean            @default(true)
  criado_em           DateTime           @default(now()) @db.Timestamp(6)
  
  responsaveis        SalaResponsavel[]
  agendamentos        Agendamento[]
  acessos             Acesso[]

  @@map("sala")
}

model SalaResponsavel {
  id         Int       @id @default(autoincrement())
  sala_id    Int
  nome       String    @db.Text
  valido_de  DateTime  @db.Date
  valido_ate DateTime? @db.Date
  ativo      Boolean   @default(true)
  criado_em  DateTime  @default(now()) @db.Timestamp(6)
  
  sala       Sala      @relation(fields: [sala_id], references: [id])

  @@map("sala_responsavel")
}

model Feriado {
  id        Int      @id @default(autoincrement())
  data      DateTime @db.Date
  descricao String   @db.Text
  tipo      Int      @db.SmallInt
  ativo     Boolean  @default(true)
  criado_em DateTime @default(now()) @db.Timestamp(6)

  @@map("feriado")
}

model Agendamento {
  id             Int       @id @default(autoincrement())
  visitante_id   Int
  sala_id        Int
  data_agendada  DateTime  @db.Timestamp(6)
  hora_fim       DateTime  @db.Timestamp(6)
  status         Int       @default(1) @db.SmallInt
  ativo          Boolean   @default(true)
  criado_em      DateTime  @default(now()) @db.Timestamp(6)
  
  visitante      Visitante @relation(fields: [visitante_id], references: [id])
  sala           Sala      @relation(fields: [sala_id], references: [id])
  acessos        Acesso[]

  @@map("agendamento")
}

model Acesso {
  id             Int          @id @default(autoincrement())
  visitante_id   Int
  sala_id        Int
  agendamento_id Int?
  entrada_em     DateTime     @db.Timestamp(6)
  saida_em       DateTime?    @db.Timestamp(6)
  ativo          Boolean      @default(true)
  criado_em      DateTime     @default(now()) @db.Timestamp(6)
  
  visitante      Visitante    @relation(fields: [visitante_id], references: [id])
  sala           Sala         @relation(fields: [sala_id], references: [id])
  agendamento    Agendamento? @relation(fields: [agendamento_id], references: [id])

  @@map("acesso")
}
